{include file='public/meta' }

<title>栏目管理 - Muyu CMS内容管理系统</title>
<meta name="keywords" content="Muyu CMS内容管理系统,Muyu,木鱼CMS,木鱼">
<meta name="description" content="木鱼(muyucms.com)内容管理系统是一个简洁、轻量、实用的建站系统！">
{load href="__ADMINLIB__laypage/page.css"}
</head>
<body>
    <style type="text/css" media="all">
        .pmenu-c{background:#e9e8e8}
    </style>
	<div class="wap-container">
		<nav class="breadcrumb" style="background-color:#fff;padding: 0 24px">
			首页
			<span class="c-gray en">/</span>
			栏目管理
			<span class="c-gray en">/</span>
			栏目列表
			<a class="btn btn-success radius f-r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);"
			 title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a>
		</nav>
		<article class="Hui-admin-content clearfix">
			<div class="panel mt-0">
				<div class="panel-body">
					<div class="clearfix">
						<span class="f-l">
							<a href="javascript:;" id="datadel" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i>
								批量删除</a>
							<a class="btn btn-primary radius" onclick="admin_edit('添加栏目','{:url('HomeMenus/create')}')"
							 href="javascript:;"><i class="Hui-iconfont">&#xe600;</i> 添加栏目</a>
						</span>
						<span class="f-r">共有数据：<strong>{$menu->count('id')}</strong> 条</span>
					</div>

					<div class="mt-20 clearfix">
						<table class="table table-border table-bordered table-hover table-bg table-sort">
							<thead>
								<tr class="text-c">
									<th width="25"><input type="checkbox" name="" value=""></th>
									<th width="50">子栏目</th>
									<th width="80">ID</th>
									<th width="80">栏目名称</th>
									<th width="80">栏目所属</th>
									<th width="80">栏目ico</th>
									<th width="80">栏目背景图</th>
									<th width="80">栏目描述</th>
									<th width="80">排序</th>
									<th>栏目地址</th>
									<th width="80">栏目状态</th>
									<th width="100">操作</th>
								</tr>
							</thead>
							{foreach $menu as $val}
							<tbody>
								
								<tr class="text-c">
									<td><input type="checkbox" name="" value="{$val.id}"></td>
									{if condition="empty($val.pmenu)"}
									<td><a class="Hui-iconfont">&#xe706;</a></td>
									{else/}
									<td><a href="#pmenu" class="Hui-iconfont" id="menutext{$val.id}" onclick="pmenus({$val.id})" alt="展开子栏目">&#xe604;</a></td>
									{/if}
									<td><a title="点击预览前台列表" target="_blank" href="/artlist_{$val.id}.html">{$val.id}</a></td>
									<td>{$val.title}</td>
									<td>{$val.p_title}</td>
									<td>{$val.icon}</td>
									<td>{if condition='empty($val.titlepic)'}暂无图片{else /}<img src="{$val.titlepic}" height="80" width="120" alt="{$val.title}">{/if}</td>
									<td>{if condition="empty($val.comment)"}暂无描述{else /}{/if}{$val.comment}</td>
									<td>{$val.sort}</td>
									<td>{if condition="$val.links == 1"}{$val.href}{else /}内部链接{/if}</td>
									<td class="td-status">
										{if condition="$val.status eq '已启用'"}
										<span class="label label-success radius">{$val.status}</span>
										{else /}
										<span class="label radius">{$val.status}</span>
										{/if}
										</td>
										 <td class="f-14 td-manage">
											{eq name="$Think.session.Adminuser.id" value="1"}
										 	{if condition="$val.status eq '已启用'"}
										 	<a style="text-decoration:none" onClick="menu_stop(this,'{$val.id}')" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a>
										 	{else /}
										 	<a style="text-decoration:none" onClick="menu_start(this,'{$val.id}')" href="javascript:;" title="启用"><i class="Hui-iconfont">&#xe615;</i></a>
										 	{/if}
											{/eq}
										 	<a title="编辑" href="javascript:;" onclick="admin_edit('栏目编辑','{:url('HomeMenus/edit')}'+'?id='+{$val.id}+'&page='+{$page})"
										 	 style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a> <a title="删除" class="del" data-name="{$val.title}" data-id="{$val.id}" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>
										 </td>
								</tr>
								{if condition="!empty($val.pmenu)"}
								{foreach $val.pmenu as $va}
								<tr class="text-c pmenu-c lm{$val.id}" style="display:none;">
									<td><input type="checkbox" name="" value="{$va.id}"></td>
									<td>├</td>
									<td>{$va.id}</td>
									<td>{$va.title}</td>
									<td>{$va.p_title}</td>
									<td>{$va.icon}</td>
									<td>{if condition='empty($val.titlepic)'}暂无图片{else /}<img src="{$va.titlepic}" height="80" width="120" alt="{$va.title}">{/if}</td>
									<td>{if condition="empty($va.comment)"}暂无描述{else /}{/if}{$va.comment}</td>
									<td>{$val.sort}</td>
									<td>{if condition="$va.links == 1"}{$va.href}{else /}内部链接{/if}</td>
									<td class="td-status">
										{if condition="$va.status eq '已启用'"}
										<span class="label label-success radius">{$va.status}</span>
										{else /}
										<span class="label radius">{$va.status}</span>
										{/if}
										</td>
										 <td class="f-14 td-manage">
											{eq name="$Think.session.Adminuser.id" value="1"}
										 	{if condition="$va.status eq '已启用'"}
										 	<a style="text-decoration:none" onClick="menu_stop(this,'{$va.id}')" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a>
										 	{else /}
										 	<a style="text-decoration:none" onClick="menu_start(this,'{$va.id}')" href="javascript:;" title="启用"><i class="Hui-iconfont">&#xe615;</i></a>
										 	{/if}
											{/eq}
										 	<a title="编辑" href="javascript:;" onclick="admin_edit('栏目编辑','{:url('HomeMenus/edit')}'+'?id='+{$va.id}+'&page='+{$page})"
										 	 style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a> <a title="删除" class="del" data-name="{$va.title}" data-id="{$va.id}" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>
										 </td>
								</tr>
								{/foreach}
								{/if}
								
							</tbody>
							{/foreach}
						</table>
					</div>
					{$menu|raw}
				</div>
			</div>
		</article>
	</div>
	{include file='public/footer' }

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="__ADMINLIB__datatables/1.10.15/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="__ADMINLIB__laypage/1.2/laypage.js"></script>
	<script type="text/javascript" src="__ADMINST__business/js/main.js"></script>
	<!--/请在上方写此页面业务相关的脚本-->
	<script type="text/javascript">
		$(function() {
			// 全选 页面调用
			$(".table").HuicheckAll({
					checkboxAll: 'thead input[type="checkbox"]',
					checkbox: 'tbody input[type="checkbox"]'
				},
				function(checkedInfo) {
				// 	console.log(checkedInfo);
				}
			)
		});
	</script>
	<script>
		function pmenus($id){
		    var pid = "lm"+$id;
		    var mid = "menutext"+$id;
		 var  alist = document.getElementsByClassName(pid);
         if (alist){
             for ( var  idx = 0; idx < alist.length; idx ++){
                 var  mya = alist[idx];
                 if(mya.style.display == "none"){
		       mya.style.display = "table-row";
               document.getElementById(mid).innerText = "";
		    }else{
		       mya.style.display =  "none" ;
		       document.getElementById(mid).innerText = "";
		    }
            }
         }
		}
		
		$(".del").click(function() {
			//获取删除信息和对应id
			var title = $(this).attr('data-name');
			var id = $(this).attr('data-id');
			layer.msg('是否删除\"' + title + '\"栏目?', {
				time: 5000, //5s后自动关闭
				shade: 0.3,
				btn: ['删除', '取消'],
				yes: function() {
					//执行删除
				// 	console.log(id);
					$.post("{:url('HomeMenus/delete')}", {
						ids: id
					}, function(data) {
						layer.msg(data.msg, {
							time: 2000
						}, function() {
							if (data.url) location.href = data.url;
						});
					})
				}
			});
		})
	</script>
	<script>
		/*管理员-停用*/
		function menu_stop(obj,id){
		  layer.confirm('确认要停用吗？',function(index){
		    //此处请求后台程序，下方是成功后的前台处理……
			$.get("{:url('HomeMenus/setstatus')}",{id:id});
			
		    $(obj).parents("tr").find(".td-manage").prepend('<a onClick="menu_start(this,'+id+')" href="javascript:;" title="启用" style="text-decoration:none"><i class="Hui-iconfont">&#xe615;</i></a>');
		    $(obj).parents("tr").find(".td-status").html('<span class="label radius">已停用</span>');
		    $(obj).remove();
		    layer.msg('已停用!',{icon: 5,time:1000});
		  });
		}
		
		/*管理员-启用*/
		function menu_start(obj,id){
		  layer.confirm('确认要启用吗？',function(index){
		    //此处请求后台程序，下方是成功后的前台处理……
			$.get("{:url('HomeMenus/setstatus')}",{id:id});
		
		    $(obj).parents("tr").find(".td-manage").prepend('<a onClick="menu_stop(this,'+id+')" href="javascript:;" title="停用" style="text-decoration:none"><i class="Hui-iconfont">&#xe631;</i></a>');
		    $(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已启用</span>');
		    $(obj).remove();
		    layer.msg('已启用!', {icon: 6,time:1000});
		  });
		}
		
		//批量删除
		$("#datadel").click(function() {
		var id=$("tbody input:checkbox");
		var ids=[];
		for(i=0;i<id.length;i++){
			if($(id[i]).is(":checked")){
				ids += $(id[i]).val()+',';
			}
		}
		//console.log(ids);
			var delid = ids;
// 			console.log(delid);
		if(delid == ""){
			layer.msg('当前未选择任何信息!',{icon:2,time:2000});
		}else{
			
			layer.confirm('确认要批量删除吗？',function(index){
			//console.log(delid);
			$.post("{:url('HomeMenus/deleteall')}",{delid},function(data){
				layer.msg(data.msg, {time: 2000}, function() {
					if(data.url) location.href = data.url;
				});
			});
			});
		}
		});
	</script>
</body>
</html>
